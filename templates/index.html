<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2D 开奖系统</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>2D 开奖页面</h1>
        <a href="javascript:void(0)" onclick="startDraw()" class="draw-button">🎯 开奖</a>

        <!-- 动态插入开奖区 -->
        <div id="draw-area"></div>
    </div>

    <script>
        function startDraw() {
            fetch('/draw')
                .then(res => res.json())
                .then(data => {
                    const drawBox = document.createElement('div');
                    drawBox.className = 'draw-box';

                    // 局号
                    const title = document.createElement('h2');
                    title.textContent = `局号：${data.code}`;
                    drawBox.appendChild(title);

                    // 头奖标题
                    const headTitle = document.createElement('div');
                    headTitle.className = 'result-title';
                    headTitle.textContent = '头奖：';
                    drawBox.appendChild(headTitle);

                    // 头奖区域（1格）
                    const headGrid = document.createElement('div');
                    headGrid.className = 'result-table';
                    headGrid.style.gridTemplateColumns = '1fr';

                    const headBox = document.createElement('div');
                    headBox.className = 'result-box blank';
                    headBox.id = `head-number-${data.code}`;
                    headBox.textContent = '--';
                    headGrid.appendChild(headBox);
                    drawBox.appendChild(headGrid);

                    // 特别奖标题
                    const specialTitle = document.createElement('div');
                    specialTitle.className = 'result-title';
                    specialTitle.textContent = '特别奖：';
                    drawBox.appendChild(specialTitle);

                    // 特别奖区域（3列2行）
                    const specialGrid = document.createElement('div');
                    specialGrid.className = 'result-table';
                    specialGrid.id = `special-numbers-${data.code}`;
                    for (let i = 0; i < 6; i++) {
                        const box = document.createElement('div');
                        box.className = 'result-box blank';
                        box.id = `special-${data.code}-${i}`;
                        box.textContent = '--';
                        specialGrid.appendChild(box);
                    }
                    drawBox.appendChild(specialGrid);

                    // 插入页面顶部
                    document.getElementById('draw-area').prepend(drawBox);

                    // 动态逐个填入特别奖
                    let i = 0;
                    const nums = data.special.slice();

                    const interval = setInterval(() => {
                        if (i < nums.length) {
                            const span = document.getElementById(`special-${data.code}-${i}`);
                            span.textContent = nums[i];
                            span.classList.remove('blank');
                            i++;
                        } else {
                            clearInterval(interval);
                            // 10秒后公布头奖
                            setTimeout(() => {
                                const chosen = nums[Math.floor(Math.random() * nums.length)];
                                const headSpan = document.getElementById(`head-number-${data.code}`);
                                headSpan.textContent = chosen;
                                headSpan.classList.remove('blank');

                                for (let j = 0; j < 6; j++) {
                                    const s = document.getElementById(`special-${data.code}-${j}`);
                                    if (s.textContent === chosen) {
                                        s.textContent = '--';
                                        s.classList.add('blank');
                                        break;
                                    }
                                }
                            }, 10000);
                        }
                    }, 5000);
                });
        }
    </script>
</body>
</html>
