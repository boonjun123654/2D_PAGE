<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>2D å¼€å¥–ç³»ç»Ÿ</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <style>
    .draw-box[data-market] {
      border: 3px solid #000;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>2D å¼€å¥–é¡µé¢</h1>
  <a href="javascript:void(0)" onclick="startDraw()" class="draw-button">ğŸ¯ å¼€å¥–</a>

  <!-- åŠ¨æ€æ’å…¥å¼€å¥–åŒº -->
  <div id="draw-area"></div>
</div>

<script>
const markets = [
  { code: 'M', name: 'Magnum', color: '#ffff00' },
  { code: 'T', name: 'Toto', color: '#cc0000' },
  { code: 'P', name: 'Damacai', color: '#0000ff' },
  { code: 'S', name: 'Singapore', color: '#4c8ed1' },
  { code: 'H', name: 'Grand Dragon', color: '#fed606' },
  { code: 'E', name: '9 Lotto', color: '#ffa500' },
  { code: 'K', name: 'Sandakan', color: '#008835' },
  { code: 'B', name: 'Sabah', color: '#e51d20' },
  { code: 'W', name: 'Sarawak', color: '#00540e' }
];

function startDraw() {
  markets.forEach(market => {
    fetch('/draw')
      .then(res => res.json())
      .then(data => {
        const drawBox = document.createElement('div');
        drawBox.className = 'draw-box';
        drawBox.dataset.market = market.code;
        drawBox.style.backgroundColor = market.color;

        // æ ‡é¢˜
        const title = document.createElement('h2');
        title.textContent = `${market.name}ï¼ˆ${data.code}ï¼‰`;
        drawBox.appendChild(title);

        // å¤´å¥–æ ‡é¢˜
        const headTitle = document.createElement('div');
        headTitle.className = 'result-title';
        headTitle.textContent = 'å¤´å¥–ï¼š';
        drawBox.appendChild(headTitle);

        // å¤´å¥–åŒºåŸŸï¼šå•åŒ / å·ç  / å¤§å°
        const headGrid = document.createElement('div');
        headGrid.className = 'result-table';
        headGrid.style.gridTemplateColumns = 'repeat(3, 1fr)';

        const oddEvenBox = document.createElement('div');
        oddEvenBox.className = 'result-box blank';
        oddEvenBox.id = `head-odd-even-${market.code}-${data.code}`;
        oddEvenBox.textContent = '--';

        const headBox = document.createElement('div');
        headBox.className = 'result-box blank';
        headBox.id = `head-number-${market.code}-${data.code}`;
        headBox.textContent = '--';

        const bigSmallBox = document.createElement('div');
        bigSmallBox.className = 'result-box blank';
        bigSmallBox.id = `head-big-small-${market.code}-${data.code}`;
        bigSmallBox.textContent = '--';

        headGrid.appendChild(oddEvenBox);
        headGrid.appendChild(headBox);
        headGrid.appendChild(bigSmallBox);
        drawBox.appendChild(headGrid);

        // ç‰¹åˆ«å¥–æ ‡é¢˜
        const specialTitle = document.createElement('div');
        specialTitle.className = 'result-title';
        specialTitle.textContent = 'ç‰¹åˆ«å¥–ï¼š';
        drawBox.appendChild(specialTitle);

        // ç‰¹åˆ«å¥–åŒºåŸŸ
        const specialGrid = document.createElement('div');
        specialGrid.className = 'result-table';
        specialGrid.id = `special-numbers-${market.code}-${data.code}`;
        for (let i = 0; i < 6; i++) {
          const box = document.createElement('div');
          box.className = 'result-box blank';
          box.id = `special-${market.code}-${data.code}-${i}`;
          box.textContent = '--';
          specialGrid.appendChild(box);
        }
        drawBox.appendChild(specialGrid);

        // æ’å…¥é¡µé¢é¡¶éƒ¨
        document.getElementById('draw-area').prepend(drawBox);

        // åŠ¨æ€å¼€å¥–
        let i = 0;
        const nums = data.special.slice();

        const interval = setInterval(() => {
          if (i < nums.length) {
            const span = document.getElementById(`special-${market.code}-${data.code}-${i}`);
            span.textContent = nums[i];
            span.classList.remove('blank');
            i++;
          } else {
            clearInterval(interval);
            setTimeout(() => {
              const chosen = parseInt(nums[Math.floor(Math.random() * nums.length)]);
              document.getElementById(`head-number-${market.code}-${data.code}`).textContent = chosen.toString().padStart(2, '0');
              document.getElementById(`head-number-${market.code}-${data.code}`).classList.remove('blank');

              document.getElementById(`head-odd-even-${market.code}-${data.code}`).textContent = chosen % 2 === 0 ? 'åŒ' : 'å•';
              document.getElementById(`head-odd-even-${market.code}-${data.code}`).classList.remove('blank');

              document.getElementById(`head-big-small-${market.code}-${data.code}`).textContent = chosen >= 50 ? 'å¤§' : 'å°';
              document.getElementById(`head-big-small-${market.code}-${data.code}`).classList.remove('blank');

              // ç‰¹åˆ«å¥–ä¸­ç§»é™¤å¤´å¥–
              for (let j = 0; j < 6; j++) {
                const s = document.getElementById(`special-${market.code}-${data.code}-${j}`);
                if (s.textContent === chosen.toString().padStart(2, '0')) {
                  s.textContent = '--';
                  s.classList.add('blank');
                  break;
                }
              }
            }, 10000);
          }
        }, 5000);
      });
  });
}
</script>
</body>
</html>
