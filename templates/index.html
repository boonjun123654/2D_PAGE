<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>2D ÂºÄÂ•ñÁ≥ªÁªüÔºàSnapshotÔºâ</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<div class="container">
  <h1>2D</h1>
  <a href="javascript:void(0)" onclick="startDraw()" class="draw-button">üéØ ÂºÄÂ•ñ</a>

  <div class="market-area" id="draw-area"></div>
</div>

<script>
const today = new Date();
const dateStr = today.toLocaleDateString('en-GB', {
  weekday: 'short', day: '2-digit', month: 'short', year: 'numeric'
}).replace(',', '');

const markets = [
  { code: 'M', name: 'Magnum', color: '#ffff00', logo: 'magnum.png' },
  { code: 'P', name: 'Damacai', color: '#0000ff', logo: 'damacai.png' },
  { code: 'T', name: 'SportsToto', color: '#cc0000', logo: 'toto.png' },
  { code: 'S', name: 'Singapore', color: '#4c8ed1', logo: 'singapore.png' },
  { code: 'H', name: 'Grand Dragon', color: '#ff0000', logo: 'grand_dragon.png' },
  { code: 'E', name: '9 Lotto', color: '#ffa500', logo: '9lotto.png' },
  { code: 'B', name: 'Sabah', color: '#e51d20', logo: 'sabah.png' },
  { code: 'K', name: 'Sandakan', color: '#008835', logo: 'sandakan.png' },
  { code: 'W', name: 'Sarawak', color: '#00540e', logo: 'sarawak.png' }
];

window.onload = () => {$1
  // Ëá™Âä®Âú® 09:51~23:51 ÂêØÂä®‰∏ÄËΩÆÂºÄÂ•ñ
  scheduleAutoStart();
}; color: ${textColor};\">
        <img src=\"/static/${market.logo}\" alt=\"${market.name}\" class=\"market-logo\">
        <div class=\"market-title\">
          <div><strong>${market.name} 2D</strong></div>
          <div>( ${dateStr} )</div>
        </div>
      </div>
      <div class=\"section-title\">1st Prize</div>
      <div class=\"result-table\">
        <div class=\"result-box blank\" id=\"odd-even-${market.code}\">--</div>
        <div class=\"result-box blank\" id=\"head-${market.code}\">--</div>
        <div class=\"result-box blank\" id=\"big-small-${market.code}\">--</div>
      </div>
      <div class=\"section-title\">Special Prize</div>
      <div class=\"result-table\" style=\"grid-template-columns: repeat(3, 1fr);\" id=\"special-${market.code}\">
        ${Array.from({length: 3}).map((_, i) => `<div class=\"result-box blank\" id=\"special-${market.code}-${i}\">--</div>`).join('')}
      </div>
    `;
    container.appendChild(box);
  });
};

function startDraw() {
  markets.forEach(market => {
    fetch(`/draw?market=${market.code}`)
      .then(res => res.json())
      .then(data => { const headFromServer = data.head ? parseInt(data.head, 10) : null;
        const nums = ((data.special || data.specials || [])).slice(0, 3).map(n => n.toString().padStart(2, '0'));
        let i = 0;

        const interval = setInterval(() => {
          if (i < nums.length) {
            const el = document.getElementById(`special-${market.code}-${i}`);
            el.textContent = nums[i];
            el.classList.remove('blank');
            i++;
          } else {
            clearInterval(interval);
            {
              const chosen = (headFromServer !== null) ? headFromServer : parseInt(nums[Math.floor(Math.random() * nums.length)]);
              const headBox = document.getElementById(`head-${market.code}`);
              headBox.textContent = chosen.toString().padStart(2, '0');
              headBox.classList.remove('blank');

              const oddEven = document.getElementById(`odd-even-${market.code}`);
              oddEven.textContent = chosen % 2 === 0 ? 'Âèå' : 'Âçï';
              oddEven.classList.remove('blank');

              const bigSmall = document.getElementById(`big-small-${market.code}`);
              bigSmall.textContent = chosen >= 50 ? 'Â§ß' : 'Â∞è';
              bigSmall.classList.remove('blank');

              for (let j = 0; j < nums.length; j++) {
                const s = document.getElementById(`special-${market.code}-${j}`);
                if (s.textContent === chosen.toString().padStart(2, '0')) {
                  s.textContent = '--';
                  s.classList.add('blank');
                  break;
                }
              }
            } // ÊòæÁ§∫ÂÆå 3 ‰∏™ special ÂêéÔºåÁ´ãÂç≥ÊòæÁ§∫Â§¥Â•ñ/ÂçïÂèå/Â§ßÂ∞è
          }
        }, 10000);  // ÊØèÈ¢ó special Â•ñÂè∑Âá∫Áé∞Èó¥ÈöîÔºàÊîπ‰∏∫10ÁßíÔºâ
      });
  });
}

// Ëá™Âä®Âú® 09:51~23:51 ÂêØÂä®
function scheduleAutoStart(){
  const now = new Date();
  const h = now.getHours();
  if (h < 9 || h > 23) return; // Âè™Âú® 9~23 ÁÇπÂÜÖ
  if (now.getMinutes() >= 51) {
    startDraw();
  } else {
    const target = new Date(now);
    target.setMinutes(51, 0, 0);
    const ms = target - now;
    if (ms > 0) setTimeout(startDraw, ms);
  }
}
</script>
</body>
</html>
