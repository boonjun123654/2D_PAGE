<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>2D 开奖系统</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <style>
    .market-area {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 12px;
    }

    .draw-box {
      flex: 1 1 280px;
      max-width: 300px;
    }

    .draw-box h2 {
      font-size: 18px;
      margin-bottom: 8px;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>2D 开奖页面</h1>
  <a href="javascript:void(0)" onclick="startDraw()" class="draw-button">🎯 开奖</a>

  <!-- 固定显示 9 个市场 -->
  <div class="market-area" id="draw-area"></div>
</div>

<script>
const markets = [
  { code: 'M', name: 'Magnum', color: '#ffff00' },
  { code: 'P', name: 'Damacai', color: '#0000ff' },
  { code: 'T', name: 'Toto', color: '#cc0000' },
  { code: 'S', name: 'Singapore', color: '#4c8ed1' },
  { code: 'H', name: 'Grand Dragon', color: '#fed606' },
  { code: 'E', name: '9 Lotto', color: '#ffa500' },
  { code: 'B', name: 'Sabah', color: '#e51d20' },
  { code: 'K', name: 'Sandakan', color: '#008835' },
  { code: 'W', name: 'Sarawak', color: '#00540e' }
];

// 初始化 9 个市场框
window.onload = () => {
  const container = document.getElementById('draw-area');
  markets.forEach(market => {
    const box = document.createElement('div');
    box.className = 'draw-box';
    box.style.backgroundColor = market.color;
    box.id = `draw-box-${market.code}`;
    box.innerHTML = `
      <h2>${market.name}</h2>
      <div class="result-title">头奖：</div>
      <div class="result-table" style="grid-template-columns: repeat(3, 1fr);">
        <div class="result-box blank" id="odd-even-${market.code}">--</div>
        <div class="result-box blank" id="head-${market.code}">--</div>
        <div class="result-box blank" id="big-small-${market.code}">--</div>
      </div>
      <div class="result-title">特别奖：</div>
      <div class="result-table" id="special-${market.code}">
        ${Array.from({length: 6}).map((_, i) => `<div class="result-box blank" id="special-${market.code}-${i}">--</div>`).join('')}
      </div>
    `;
    container.appendChild(box);
  });
};

// 开始开奖逻辑
function startDraw() {
  markets.forEach(market => {
    fetch('/draw')
      .then(res => res.json())
      .then(data => {
        const nums = data.special.slice();
        let i = 0;

        const interval = setInterval(() => {
          if (i < nums.length) {
            const el = document.getElementById(`special-${market.code}-${i}`);
            el.textContent = nums[i];
            el.classList.remove('blank');
            i++;
          } else {
            clearInterval(interval);
            setTimeout(() => {
              const chosen = parseInt(nums[Math.floor(Math.random() * nums.length)]);
              const headBox = document.getElementById(`head-${market.code}`);
              headBox.textContent = chosen.toString().padStart(2, '0');
              headBox.classList.remove('blank');

              const oddEven = document.getElementById(`odd-even-${market.code}`);
              oddEven.textContent = chosen % 2 === 0 ? '双' : '单';
              oddEven.classList.remove('blank');

              const bigSmall = document.getElementById(`big-small-${market.code}`);
              bigSmall.textContent = chosen >= 50 ? '大' : '小';
              bigSmall.classList.remove('blank');

              for (let j = 0; j < 6; j++) {
                const s = document.getElementById(`special-${market.code}-${j}`);
                if (s.textContent === chosen.toString().padStart(2, '0')) {
                  s.textContent = '--';
                  s.classList.add('blank');
                  break;
                }
              }
            }, 10000);
          }
        }, 5000);
      });
  });
}
</script>
</body>
</html>
