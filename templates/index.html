<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>2D å¼€å¥–ç³»ç»Ÿ</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="container">
    <h1>2D å¼€å¥–é¡µé¢</h1>
    <a href="javascript:void(0)" onclick="startDraw()" class="draw-button">ğŸ¯ å¼€å¥–</a>

    <!-- åŠ¨æ€æ’å…¥å¼€å¥–åŒº -->
    <div id="draw-area"></div>
  </div>

  <script>
    function startDraw() {
      fetch('/draw')
        .then(res => res.json())
        .then(data => {
          const drawBox = document.createElement('div');
          drawBox.className = 'draw-box';

          // å±€å·
          const title = document.createElement('h2');
          title.textContent = `å±€å·ï¼š${data.code}`;
          drawBox.appendChild(title);

          // å¤´å¥–æ ‡é¢˜
          const headTitle = document.createElement('div');
          headTitle.className = 'result-title';
          headTitle.textContent = 'å¤´å¥–ï¼š';
          drawBox.appendChild(headTitle);

          // å¤´å¥–åŒºï¼ˆ3æ ¼ï¼šå•åŒ / æ•°å­— / å¤§å°ï¼‰
          const headGrid = document.createElement('div');
          headGrid.className = 'result-table';
          headGrid.style.gridTemplateColumns = 'repeat(3, 1fr)';

          const oddEvenBox = document.createElement('div');
          oddEvenBox.className = 'result-box blank';
          oddEvenBox.id = `head-odd-even-${data.code}`;
          oddEvenBox.textContent = '--';

          const headBox = document.createElement('div');
          headBox.className = 'result-box blank';
          headBox.id = `head-number-${data.code}`;
          headBox.textContent = '--';

          const bigSmallBox = document.createElement('div');
          bigSmallBox.className = 'result-box blank';
          bigSmallBox.id = `head-big-small-${data.code}`;
          bigSmallBox.textContent = '--';

          headGrid.appendChild(oddEvenBox);
          headGrid.appendChild(headBox);
          headGrid.appendChild(bigSmallBox);
          drawBox.appendChild(headGrid);

          // ç‰¹åˆ«å¥–æ ‡é¢˜
          const specialTitle = document.createElement('div');
          specialTitle.className = 'result-title';
          specialTitle.textContent = 'ç‰¹åˆ«å¥–ï¼š';
          drawBox.appendChild(specialTitle);

          // ç‰¹åˆ«å¥–åŒºåŸŸï¼ˆ3åˆ—Ã—2è¡Œï¼‰
          const specialGrid = document.createElement('div');
          specialGrid.className = 'result-table';
          specialGrid.id = `special-numbers-${data.code}`;
          for (let i = 0; i < 6; i++) {
            const box = document.createElement('div');
            box.className = 'result-box blank';
            box.id = `special-${data.code}-${i}`;
            box.textContent = '--';
            specialGrid.appendChild(box);
          }
          drawBox.appendChild(specialGrid);

          // æ’å…¥é¡µé¢é¡¶éƒ¨
          document.getElementById('draw-area').prepend(drawBox);

          // å¼€å§‹é€ä¸ªå¼€å¥–ç‰¹åˆ«å¥–ï¼ˆæ¯ 5 ç§’ä¸€ä¸ªï¼‰
          let i = 0;
          const nums = data.special.slice();

          const interval = setInterval(() => {
            if (i < nums.length) {
              const span = document.getElementById(`special-${data.code}-${i}`);
              span.textContent = nums[i];
              span.classList.remove('blank');
              i++;
            } else {
              clearInterval(interval);

              // ç­‰ 10 ç§’åï¼Œå…¬å¸ƒå¤´å¥– + å•åŒ + å¤§å°
              setTimeout(() => {
                const chosen = parseInt(nums[Math.floor(Math.random() * nums.length)]);
                const headSpan = document.getElementById(`head-number-${data.code}`);
                const oddEvenSpan = document.getElementById(`head-odd-even-${data.code}`);
                const bigSmallSpan = document.getElementById(`head-big-small-${data.code}`);

                // æ˜¾ç¤ºå¤´å¥–
                headSpan.textContent = chosen.toString().padStart(2, '0');
                headSpan.classList.remove('blank');

                // åˆ¤æ–­å•åŒ
                oddEvenSpan.textContent = (chosen % 2 === 0) ? 'åŒ' : 'å•';
                oddEvenSpan.classList.remove('blank');

                // åˆ¤æ–­å¤§å°
                bigSmallSpan.textContent = (chosen >= 50) ? 'å¤§' : 'å°';
                bigSmallSpan.classList.remove('blank');

                // ä»ç‰¹åˆ«å¥–ä¸­ç§»é™¤è¯¥å·ç ï¼ˆå˜æˆç©ºï¼‰
                for (let j = 0; j < 6; j++) {
                  const s = document.getElementById(`special-${data.code}-${j}`);
                  if (s.textContent === chosen.toString().padStart(2, '0')) {
                    s.textContent = '--';
                    s.classList.add('blank');
                    break;
                  }
                }
              }, 10000);
            }
          }, 5000);
        });
    }
  </script>
</body>
</html>
